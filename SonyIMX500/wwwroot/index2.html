<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <title>Token tool</title>
</head>
<body>

    <table>
        <tr>
            <td>
                <span>Client Id</span>
            </td>
            <td colspan="2">
                <input id="clientId" type="text" style="display: block; width: 50em;" onchange="renewAuthConfig()">
            </td>
        </tr>
        <tr style="vertical-align:top">
            <td>
                <span>Id Token</span>
            </td>
            <td colspan="2">
                <textarea id="idToken" cols="30" rows="10" style="display: block; overflow-y: scroll; width:50em; height:5em;" readonly></textarea>
            </td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2">
                <button type="button" id="btnCopyToken">Copy Token</button>
            </td>
        </tr>
        <tr>
            <td>
                Expire time:
            </td>
            <td colspan="2">
                <span id='idExpire'></span>
            </td>
        </tr>
        <tr>
            <td>
                Last update:
            </td>
            <td colspan="2">
                <span id='lastTime'></span>
            </td>
        </tr>
        <tr>
            <td>
                Firmware List
            </td>
            <td colspan="2">
                <button type="button" id="btnGetFirmware">Get Firmwares</button>
            </td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2">
                <table>
                    <tr>
                        <td>
                            MCU(AppFW) Versions
                        </td>
                        <td>
                            <select id="firmwareMCU" style="min-width:10em"></select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            IMX500(Sensor) Versions
                        </td>
                        <td>
                            <select id="firmwareSensor" style="min-width:10em"></select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            IMX500(SensorLoader) Versions
                        </td>
                        <td>
                            <select id="firmwareSensorLoader" style="min-width:10em"></select>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                Device List
            </td>
            <td colspan="2">
                <select id="idDevices" style="min-width:10em"></select>
                <button type="button" id="btnGetDevices">Refresh</button>
            </td>
        </tr>
        <tr>
            <td>
                Device Detail
            </td>
            <td>
                <button type="button" id="btnGetDevice">Get Device Details</button>
                <button type="button" id="btnReboot">Reboot</button>
            </td>
        </tr>

        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>
                Raw Data
            </td>
            <td colspan="2">
                <textarea id="txtGetDevice" cols="30" rows="10" style="display: block; overflow-y: scroll; width: 50em; height: 5em;" readonly></textarea>
            </td>
        </tr>

        <tr>
            <td>Custom Vision</td>
            <td colspan="2">
                <select id="idProject" style="min-width:10em"></select>
                <button type="button" id="btnRefreshProject">Refresh</button>
            </td>
        </tr>
        <tr>
            <td>Create Project</td>
            <td colspan="2"><input id="idNewProject" type="text" style="display: block; width: 100em;"></td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2"><button type="button" id="btnCreateProject">CreateBaseCustomVisionProject</button></td>
        </tr>
        <tr>
            <td>Save Model</td>
            <td colspan="2"><input id="idNewModel" type="text" style="display: block; width: 100em;"></td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2"> <button type="button" id="saveCustomVisionModelBtn">SaveCustomVisionModel</button></td>
        </tr>
        <tr>
            <td>Convert Model</td>
            <td colspan="2"> <button type="button" id="convertModelBtn">ConvertModel</button></td>
        </tr>
        <tr>
            <td>Publish Model</td>
            <td colspan="2"> <button type="button" id="publishModelBtn">PublishModel</button></td>
        </tr>

        <tr>
            <td>
                Model List
            </td>
            <td colspan="2">
                <select id="deviceModels" style="min-width:10em"></select>
                <button type="button" id="btnGetModels">Refresh</button>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Model ID</td>
            <td>
                <span id="idModel"></span>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Model Projects</td>
            <td>
                <select id="modelProjects" style="min-width:10em"></select>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Model Versions</td>
            <td>
                <select id="modelVersions" style="min-width:10em"></select>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Stage</td>
            <td>
                <span id="modelStage"></span>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Result</td>
            <td>
                <span id="modelResult"></span>
            </td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2">
                <textarea id="txtModel" cols="30" rows="10" style="display: block; overflow-y: scroll; width: 50em; height: 5em;" readonly></textarea>
            </td>
        </tr>
        <tr>
            <td>Deployment</td>
            <td></td>
            <td></td>
        </tr>

    </table>
    <button type="button" id="btnStartUploadRetainingData">Start Upload Retaining Data</button>
    <button type="button" id="StartUploadInferenceResultBtn">Start Upload Inference Result</button>

    <textarea id="txtOutput" cols="30" rows="10" style="display: block; overflow-y: scroll; width: 50em; height: 10em;" readonly></textarea>

    <script src="/js/azure/msal/dist/msal.js"></script>
    <script src="/lib/jquery/dist/jquery.js"></script>
    <script src="/js/site.js"></script>
    <script>

        var expiresOn = '';
        var accessExpiresOn = '';

        window.onload = function () {

            document.getElementById('clientId').value = defaultClientId;

            initialize();
            auth();
            getTokens();
            var currentId = document.getElementById('idToken').value;

            if (currentId === '' || currentId === undefined) {
                document.getElementById('clientId').value = defaultClientId;
            }

            var interval = setInterval(function () { getTokens(); }, 300000);

            var url = window.location.href;
            //if (url.indexOf("index.html") >= 0) {
            //        url = url.replace('index.html', 'home');
            //        window.location.href = url;
            //    }
            //url = url + "home/";
            //window.location.href = url;
            GetCustomVisionProjects();
        }

        $('#btnCopyToken').click(function () {
            navigator.clipboard.writeText(document.getElementById('idToken').value);
        })

        $('#btnGetFirmware').click(function () {
            GetFirmwares();
        })

        $('#btnGetDevices').click(function () {
            GetDevices();
        });

        $('#btnGetDevice').click(function () {
            var list = document.getElementById('idDevices');
            GetDevice(list.options[list.selectedIndex].text);
        })

        $('#idDevices').change(function () {
            console.log("idDevices.change");
            var list = document.getElementById('idDevices');
            console.log(list.options[list.selectedIndex].text);

            if (list.options[list.selectedIndex].text != "") {
                GetDevice(list.options[list.selectedIndex].text)
            }
        })

        $('#btnReboot').click(function () {
            RebootDevice(list.options[list.selectedIndex].text);
        })

        $('#btnGetModels').click(function () {
            RebootDevice(list.options[list.selectedIndex].text);
        })

        $('#btnRefreshProject').click(function () {
            GetCustomVisionProjects();
        })

        $('#deviceModels').change(function () {
            var list = document.getElementById('deviceModels');

            if (list.options[list.selectedIndex].text != "") {
                // Model List from GetDevice may append version number. Model ID:Version
                var model_id = list.options[list.selectedIndex].text.split(":")[0];
                GetModels(model_id);
            }
        })

        $('#modelProjects').change(function () {

            list = document.getElementById('modelProjects');
            var model_project = list.options[list.selectedIndex].text;

            list = document.getElementById('deviceModels');
            var model_id = list.options[list.selectedIndex].text.split(":")[0];

            if (model_project != "" && model_id != "") {
                GetModelVersion(model_id, model_project, null);
            }
        })

        $('#modelVersions').change(function () {

            list = document.getElementById('modelVersions');
            var model_version = list.options[list.selectedIndex].text;

            list = document.getElementById('modelProjects');
            var model_project = list.options[list.selectedIndex].text;

            list = document.getElementById('deviceModels');
            var model_id = list.options[list.selectedIndex].text.split(":")[0];

            if (model_version != 0 && model_project != "" && model_id != "") {
                GetModelVersion(model_id, model_project, model_version);
            }
        })
        

    </script>
</body>

</html>