<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <title>Token tool</title>
</head>
<body>
    <span>Client Id</span>
    <input id="clientId" type="text" style="display: block; width:400px;" onchange="renewAuthConfig()">
    <br>
    <span>Id Token</span>
    <textarea id="idToken" cols="30" rows="10" style="display: block; overflow-y: scroll; width:700px; height:246px;" readonly></textarea>
    <span>Expire time: </span>
    <span id='idExpire'></span>
    <br>
    <br>
    <span>Last update: </span>
    <span id='lastTime'></span>

    <select id="idDevices">
    </select>
    <span><button type="button" id="btnGetDevices">GetDevices</button></span>

    <input id="idDevice" type="text" style="display: block; width:400px;" value="7c9ebd92cc24">
    <span><button type="button" id="btnGetDevice">GetDevice</button></span>
    <textarea id="txtGetDevice" cols="30" rows="10" style="display: block; overflow-y: scroll; width:700px; height:246px;" readonly></textarea>

    <script src="/js/azure/msal/dist/msal.js"></script>
    <script src="/lib/jquery/dist/jquery.js"></script>
    <script src="/js/site.js"></script>
    <script>

        var expiresOn = '';
        var accessExpiresOn = '';

        window.onload = function () {

            document.getElementById('clientId').value = defaultClientId;

            initialize();
            auth();
            getTokens();
            var currentId = document.getElementById('idToken').value;

            if (currentId === '' || currentId === undefined) {
                document.getElementById('clientId').value = defaultClientId;
            }

            var interval = setInterval(function () { getTokens(); }, 300000);

            var url = window.location.href;
            //if (url.indexOf("index.html") >= 0) {
            //        url = url.replace('index.html', 'home');
            //        window.location.href = url;
            //    }
            //url = url + "home/";
            //window.location.href = url;
        }

        $('#btnGetDevices').click(function () {
            PostToken(document.getElementById('idToken').value);

            $.ajax({
                type: "GET",
                url: window.location.href + 'home/GetDevices',
                data: { },
                success: function (response) {
                    var json = JSON.parse(response.value);
                    console.log(JSON.stringify(json, null, 2));
                    document.getElementById('txtGetDevice').value = JSON.stringify(json, null, 2);
                },
                error: function (req, status, error) {
                    alert("btnGetDevices() : Error " + status);
                }
            });
        })

        $('#btnGetDevice').click(function () {
            PostToken(document.getElementById('idToken').value);

            $.ajax({
                type: "POST",
                url: window.location.href + 'home/GetDevice',
                data: { deviceId: document.getElementById('idDevice').value },
                success: function (response) {
                    var json = JSON.parse(response.value);
                    console.log(JSON.stringify(json, null, 2));
                    document.getElementById('txtGetDevice').value = JSON.stringify(json, null, 2);
                },
                error: function (req, status, error) {
                    alert("Error " + status);
                }
            });
        })
    </script>
</body>

</html>